var formatMoney=function(n,t){return{require:"?ngModel",restrict:"A",scope:{myModel:"=",precision:"=",formatMoneyNoInput:"="},link:function(n,i){(n.precision==null||n.precision==undefined)&&(n.precision=0);i.maskMoney({allowNegative:!0,thousands:",",decimal:".",affixesStay:!1,allowZero:!0,precision:n.precision});i.keydown(function(r){var u=String.fromCharCode(r.which);if(_.contains(n.formatMoneyNoInput,u)){r.preventDefault();return}t(function(){n.myModel=parseFloat(i.val().replace(new RegExp(",","g"),""));i.trigger("change")})});n.$watch("myModel",function(){$.isNumeric(n.myModel)&&n.myModel.toString().indexOf(".")>0?i.val(n.myModel.toFixed(n.precision)).trigger("mask.maskMoney"):i.val(n.myModel).trigger("mask.maskMoney")})}}},getWidth,getHeight,lazyLoad,noInput,whenEnter,compile,inputFormat,fileUpload;formatMoney.$inject=["$filter","$timeout"];getWidth=function(n,t){return{restrict:"A",scope:{getWidth:"="},link:function(n,i){$(function(){n.getWidth=i[0].offsetWidth;t(function(){n.getWidth=i[0].offsetWidth},500)})}}};getWidth.$inject=["$timeout","$interval"];getHeight=function(n,t){return{restrict:"A",scope:{getHeight:"="},link:function(n,i){$(function(){n.getHeight=i[0].offsetHeight;t(function(){n.getHeight=i[0].offsetHeight},500)})}}};getHeight.$inject=["$timeout","$interval"];lazyLoad=function(n,t){return{restrict:"A",scope:{fncallback:"&lazyLoad"},link:function(n,i){n.IsLoaded=!1;n.raw=i[0];angular.element(t).bind("scroll",function(){var i=$(n.raw).is(":visible"),t;!n.IsLoaded&&i&&(t=$(n.raw).position().top,this.pageYOffset+this.innerHeight>=t&&(n.fncallback(),n.IsLoaded=!0,n.$apply()))})}}};lazyLoad.$inject=["$timeout","$window"];noInput=function(){return{restrict:"A",scope:{noInput:"="},link:function(n,t){t.bind("keydown keypress",function(t){var i=String.fromCharCode(t.which);_.contains(n.noInput,i)&&t.preventDefault()})}}};noInput.$inject=[];whenEnter=function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.whenEnter)}),t.preventDefault())})}};whenEnter.$inject=[];compile=function(n){return function(t,i,r){t.$watch(function(n){return n.$eval(r.compile)},function(r){i.html(r);n(i.contents())(t)})}};compile.$inject=["$compile"];inputFormat=function(n){return{require:"?ngModel",restrict:"A",link:function(t,i,r,u){function f(n){return Number(n)===n&&n%1!=0}var e=r.allowDecimal=="true"?!0:!1;(t.allowdecimal=e,t.defaultValue=r.defaultValue?r.defaultValue:!1,u)&&(i.bind("keypress",function(n){var t=n.which||n.keyCode,i=r.allowDecimal=="true"?!0:!1;if(t>47&&t<58||t==8||t==9||t==190||t==39||t==37||t==43||i&&t==46)return!0;n.preventDefault()}),u.$formatters.unshift(function(){return n(r.inputFormat)(u.$modelValue?u.$modelValue:0)}),u.$parsers.unshift(function(u){var c=r.allowDecimal=="true"?!0:!1,e,o,s,h;if(t.defaultValue&&!parseInt(u)?u=t.defaultValue:!c&&f(parseFloat(u))&&(u=t.defaultValue),e=u.replace(/[^\d|\.|\-]/g,""),e=e||0,e!="")return o=e.match(/\./g),s=e.match(/\.$/g),o=o!=null&&o.length==1&&s!=null?".":"",h=n(r.inputFormat)(e),i.val(h+o).trigger("change"),parseFloat(e)}))}}};inputFormat.$inject=["$filter"];fileUpload=function(n,t){return{restrict:"A",transclude:!0,scope:{root:"=",isMultipleFile:"=",isLoading:"=",accept:"="},template:"<ng-transclude><\/ng-transclude>",link:function(n,i){function r(){this.IsDeleted=!1;this.Base64="";this.Src="";this.DataType="";this.Http=new XMLHttpRequest;this.FileInput={};this.Percent=0;this.FileName=""}n.root||(n.root={});n.root.LstFile||(n.root.LstFile=[]);n.btnOpenDialog=i[0].querySelector(".btnOpenDialog");n.input=i[0].querySelector(".files");n.root.ActionUpload||(n.root.ActionUpload="/UploadFiles/UploadImage/");n.root.PathUpload||(n.root.PathUpload="/");n.btnOpenDialog&&n.btnOpenDialog.addEventListener("click",function(){t(function(){angular.element(n.input).trigger("click")})});n.input.addEventListener("change",function(i){t(function(){var e=i.target.files,s,o,t;if(e.length!=0){if(s=e[0].size/1048576,s>2){sys.Alert(!1,"Đính kèm không vượt quá 2 MB.");return}if(!n.root.IsMultipleFile){if(n.root.LstFile=[],e.length>1){sys.Alert(!1,"Vui lòng up 1 file");return}if(n.root.accept!=undefined&&!UtilJS.String.IsContain(n.root.accept,e[0].type)||e[0].type==""){sys.Alert(!1,"Định dạng file không đúng.");return}}for(o=0;o<e.length;o++)if(t=new r,t.FileInput=e[o],t.FileName=e[o].name.normalize(),n.root.IsListenProgress&&(t.AlertNotFoundTimeout=!1,u(t),f(t)),n.root.LstFile.push(t),!n.root.IsMultipleFile){let i=t.FileInput.name;i=i.normalize();i=i.toLowerCase();t.Http.open("POST",n.root.ActionUpload,!0);t.Http.setRequestHeader("Content-Type","multipart/form-data");t.Http.setRequestHeader("FileName",UtilJS.String.RemoveUnicode(i));t.Http.setRequestHeader("FileSize",t.FileInput.size);t.Http.setRequestHeader("FileType",t.FileInput.type);t.Http.setRequestHeader("SaveTo",n.root.SaveTo);t.Http.send(t.FileInput)}}}).then(function(){angular.element(n.input).val(null)})});n.root.API={};n.root.API.ClearLstItem=function(){n.root.LstFile=[]};n.root.API.ResetItem=function(n){n.Percent=0;n.FileName="";n.FilePathSaved=""};var u=function(n){n.Http.upload.addEventListener("progress",function(i){t(function(){fileLoaded=i.loaded;fileTotal=i.total;fileProgress=parseInt(fileLoaded/fileTotal*100)||0;n.Percent=fileProgress},50)},!1)},f=function(i){i.Http.onreadystatechange=function(){i.Http.readyState==4&&i.Http.status==200?t(function(){var n=JSON.parse(i.Http.responseText);if(n.Code!=200){i.Percent=0;i.FileName="";sys.Alert(!1,"Upload file thất bại");return}n.Code==200&&n.Success&&(i.Percent=100,i.FilePathSaved=n.Data.PathFile,i.FilePathRelative=n.FilePathRelative)},200):i.Http.readyState==4&&i.Http.status!=200&&(t.cancel(i.AlertNotFoundTimeout),i.AlertNotFoundTimeout=t(function(){i.Http.status==404?sys.Alert(!1,"Định dạng file không đúng."):i.Http.status==401||(i.Http.status==403?sys.Alert(!1,"Bạn không có quyền"):(sys.Alert(!1,"Lỗi status "+i.Http.status),console.log(i.Http)));i.Percent=0;i.FileName="";return},200));n.$apply()}};n.root.IsReady=!0}}};fileUpload.$inject=["$q","$timeout","$localstorage","ApiHelper"];